define(['jquery','mage/storage','Mageplaza_LayeredNavigation/js/model/loader'],function($,storage,loader){'use strict';var productContainer=$('#layer-product-list'),layerContainer=$('.layered-filter-block-container');return function(submitUrl){var actives=[];$('.filter-options-item').each(function(index){if($(this).hasClass('active')){actives.push($(this).attr('attribute'));}});window.layerActiveTabs=actives;loader.startLoader();if(typeof window.history.pushState==='function'){window.history.pushState({url:submitUrl},'',submitUrl);}
return storage.post(submitUrl,{}).done(function(response){if(response.backUrl){window.location=response.backUrl;return;}
if(response.navigation){layerContainer.html(response.navigation);layerContainer.trigger('contentUpdated');}
if(response.products){productContainer.html(response.products);productContainer.trigger('contentUpdated');}}).fail(function(){window.location.reload();}).always(function(){loader.stopLoader();});};});