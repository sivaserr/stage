define(['moment','mageUtils','./abstract','moment-timezone-with-data'],function(moment,utils,Abstract){'use strict';return Abstract.extend({defaults:{options:{},storeTimeZone:'UTC',validationParams:{dateFormat:'${ $.outputDateFormat }'},inputDateFormat:'y-MM-dd',outputDateFormat:'MM/dd/y',pickerDateTimeFormat:'',pickerDefaultDateFormat:'MM/dd/y',pickerDefaultTimeFormat:'h:mm a',timezoneFormat:'YYYY-MM-DD HH:mm',elementTmpl:'ui/form/element/date',listens:{'value':'onValueChange','shiftedValue':'onShiftedValueChange'},shiftedValue:''},initConfig:function(){this._super();if(!this.options.dateFormat){this.options.dateFormat=this.pickerDefaultDateFormat;}
if(!this.options.timeFormat){this.options.timeFormat=this.pickerDefaultTimeFormat;}
this.prepareDateTimeFormats();return this;},initObservable:function(){return this._super().observe(['shiftedValue']);},onValueChange:function(value){var dateFormat,shiftedValue;if(value){if(this.options.showsTime){shiftedValue=moment.tz(value,'UTC').tz(this.storeTimeZone);}else{dateFormat=this.shiftedValue()?this.outputDateFormat:this.inputDateFormat;shiftedValue=moment(value,dateFormat);}
shiftedValue=shiftedValue.format(this.pickerDateTimeFormat);}else{shiftedValue='';}
if(shiftedValue!==this.shiftedValue()){this.shiftedValue(shiftedValue);}},onShiftedValueChange:function(shiftedValue){var value,formattedValue,momentValue;if(shiftedValue){momentValue=moment(shiftedValue,this.pickerDateTimeFormat);if(this.options.showsTime){formattedValue=moment(momentValue).format(this.timezoneFormat);value=moment.tz(formattedValue,this.storeTimeZone).tz('UTC').toISOString();}else{value=momentValue.format(this.outputDateFormat);}}else{value='';}
if(value!==this.value()){this.value(value);}},prepareDateTimeFormats:function(){this.pickerDateTimeFormat=this.options.dateFormat;if(this.options.showsTime){this.pickerDateTimeFormat+=' '+this.options.timeFormat;}
this.pickerDateTimeFormat=utils.convertToMomentFormat(this.pickerDateTimeFormat);if(this.options.dateFormat){this.outputDateFormat=this.options.dateFormat;}
this.inputDateFormat=utils.convertToMomentFormat(this.inputDateFormat);this.outputDateFormat=utils.convertToMomentFormat(this.outputDateFormat);this.validationParams.dateFormat=this.outputDateFormat;}});});